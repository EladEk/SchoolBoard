rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ---- Core school data ----
    match /classes/{id} {
      allow read: if true;
      allow write: if true;   // frontend enforces "admin"
    }
    match /lessons/{id} {
      allow read: if true;
      allow write: if true;   // frontend enforces "admin"
    }
    match /timetableEntries/{id} {
      allow read: if true;
      allow write: if true;   // frontend enforces "admin"
    }
    match /announcements/{id} {
      allow read: if true;
      allow write: if true;   // frontend enforces "admin"
    }

    // ---- App users ----
    match /appUsers/{docId} {
      allow read: if true;
      allow write: if true;   // frontend enforces admin create/delete
    }

    // ---- Parliament ----
    // Dates: admins/teachers can create, edit, delete.
    match /parliamentDates/{dateId} {
      allow read: if true;
      allow write: if true;   // frontend checks admin/teacher role
    }

    // Subjects: any user can create; admin/teacher can approve/reject.
    match /parliamentSubjects/{subjectId} {
      allow read: if true;
      allow write: if true;   // frontend checks: 
                              //  - all users: create
                              //  - creator: edit pending
                              //  - admin/teacher: approve/reject/delete

      // Notes under each subject
      match /notes/{noteId} {
        allow read: if true;
        allow write: if true; // frontend enforces: only on approved subjects
      }
    }

    // ---- Legacy collections ----
    match /users/{userId} {
      allow read: if true;
      allow write: if false;
    }
    match /invites/{inviteId} {
      allow read: if true;
      allow write: if false;
    }

    // ---- Catch-all ----
    match /{document=**} {
      allow read: if true;
      allow write: if false;
    }
  }
}
